<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Content Restrictions</title>
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/8/tinymce.min.js" referrerpolicy="origin" crossorigin="anonymous"></script>
</head>
<body>
    <h1>Test Content Restrictions</h1>
    <p>This demonstrates the content restrictions applied to TinyMCE editors.</p>

    <h2>Allowed Content (Content Elements)</h2>
    <ul>
        <li>✅ Paragraphs, headings, lists</li>
        <li>✅ Links, images, tables</li>
        <li>✅ Bold, italic, underline text</li>
        <li>✅ Blockquotes, code blocks</li>
    </ul>

    <h2>Protected Content (Code Elements)</h2>
    <ul>
        <li>❌ Script tags &lt;script&gt;</li>
        <li>❌ Style tags &lt;style&gt;</li>
        <li>❌ Meta tags &lt;meta&gt;</li>
        <li>❌ PHP code &lt;?php ?&gt;</li>
        <li>❌ Template variables {{variable}} (protected in Email Builder)</li>
    </ul>

    <h2>Test Editor</h2>
    <textarea id="test-editor">Try adding different HTML elements to see what gets filtered out.</textarea>

    <script>
        tinymce.init({
            selector: '#test-editor',
            height: 400,
            menubar: true,
            plugins: [
                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
                'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
                'insertdatetime', 'media', 'table', 'help', 'wordcount'
            ],
            toolbar: 'undo redo | formatselect | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | blockquote | link image media table | code codesample | removeformat | help | preview fullscreen',

            // Content restrictions (same as implemented in the app)
            valid_elements: 'p[style],br,span[style],strong,b,em,i,u,strike,s,blockquote[style],ul,ol,li[style],h1[style],h2[style],h3[style],h4[style],h5[style],h6[style],a[href|target|title|style],img[src|alt|title|width|height|style],table[style],thead,tbody,tfoot,tr[style],th[style],td[style],caption[style],div[style|class],section[style|class],article[style|class],header[style|class],footer[style|class],aside[style|class],nav[style|class],main[style|class]',
            invalid_elements: 'script,style,meta,link,base,title,noscript,object,embed,applet,param,iframe,frame,frameset,noframes,area,map,form,input,button,select,textarea,fieldset,legend,label,optgroup,option,datalist,keygen,output,progress,meter,details,summary,command,menu,menuitem,dialog,video,audio,source,track,canvas,svg,math,template,slot',

            protect: [
                /<\?[\s\S]*?\?>/g,  // PHP code
                /<script[\s\S]*?<\/script>/gi,  // Script tags
                /<style[\s\S]*?<\/style>/gi,  // Style tags
                /<!--[\s\S]*?-->/g,  // HTML comments
                /\{\{[\s\S]*?\}\}/g,  // Template variables
                /<meta[\s\S]*?\/?>/gi,  // Meta tags
                /<link[\s\S]*?\/?>/gi,  // Link tags
                /<base[\s\S]*?\/?>/gi,  // Base tags
            ],

            // Visual feedback
            content_style: `
                body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                    font-size: 16px;
                    line-height: 1.7;
                    color: #2c3e50;
                    background-color: #ffffff;
                    margin: 2rem;
                    max-width: 800px;
                    margin-left: auto;
                    margin-right: auto;
                }

                .template-variable {
                    background: #e3f2fd !important;
                    border: 1px solid #2196f3 !important;
                    border-radius: 4px !important;
                    padding: 2px 6px !important;
                    font-family: monospace !important;
                    color: #1976d2 !important;
                    font-weight: bold !important;
                    cursor: pointer !important;
                }
            `,

            setup: function(editor) {
                editor.on('BeforeSetContent', function(e) {
                    if (e.content) {
                        // Protect template variables
                        e.content = e.content.replace(
                            /\{\{([^}]+)\}\}/g,
                            '<span class="template-variable" contenteditable="false">{{$1}}</span>'
                        );
                    }
                });

                editor.on('GetContent', function(e) {
                    if (e.content) {
                        // Restore template variables
                        e.content = e.content.replace(
                            /<span class="template-variable"[^>]*>\{\{([^}]+)\}\}<\/span>/g,
                            '{{$1}}'
                        );
                    }
                });
            }
        });
    </script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1, h2 {
            color: #2c3e50;
            margin-top: 2rem;
        }

        ul {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        li {
            margin: 0.5rem 0;
        }

        #test-editor {
            margin-top: 1rem;
        }
    </style>
</body>
</html>
